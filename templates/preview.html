{% from 'preview-unknown.html' import preview_unknown %}
{% if recent %}

{# puzzle has been assembled #}
{% set COMPLETED        = 3   %}

{% set width = recent.long if recent.table_width > recent.table_height else recent.short %}
{% set height = recent.short if recent.table_width > recent.table_height else recent.long %}

<div class="pm-Preview">
  {% if recent.link -%}
  <small class="pm-Preview-source u-textTruncate">
    Picture source:
  <a href="{{recent.link}}" rel="nofollow">
    {{recent.link|replace('http://', '')|replace('https://', '')}}
  </a>
  </small>
  {%- endif %}

      {% if recent.status == COMPLETED and not recent.is_recent -%}
      <pm-dot-require min="{{recent.pieces}}" type="info">
        This puzzle requires more dots in order to rebuild.
      </pm-dot-require>
      {% endif %}

  <a class="pm-Preview-grid" href="/chill{{ url_for('.page_uri', uri='puzzle/{}'.format(recent.puzzle_id), scale=null) }}" title="Join this jigsaw puzzle">
    <div class="pm-Preview-gridA">
      {% if recent.url == '' %}
        {{ preview_unknown(width=width, height=height, class="pm-Preview-img", style="font-size:3em;") }}
      {% else %}
        <img class="pm-Preview-img" width="{{width|int}}" height="{{height|int}}" src="{{recent.url|safe}}" alt="">
      {% endif %}

      <pm-latest-player-list
        media-path="{{ url_for('send_media_file', filename='') }}"
        puzzle-id="{{recent.puzzle_id}}"
        show-time-since="true"
        limit="9"></pm-latest-player-list>

      <p class="pm-Preview-description u-textTruncate">
        <small>
          {{recent.description}}
        </small>
      </p>
    </div>

    <div class="pm-Preview-gridB">
    <div class="pm-Preview-pieceInfo">

      <div class="pm-Preview-pieceOutline">
        <strong class="pm-Preview-pieceCount">{{recent.pieces}}</strong>
        <span>pieces</span>
      </div>

      <pm-latest-player-list
        media-path="{{ url_for('send_media_file', filename='') }}"
        puzzle-id="{{recent.puzzle_id}}"
        offset="9"></pm-latest-player-list>

    </div>
    </div>
  </a>
  {% if recent.attribution %}
  <p class="pm-Preview-attribution">{{ '[chill route /internal/attribution/{}/ ]'.format(recent.attribution) }}</p>
  {% endif %}

  {% if recent.permission == -1 -%}
  <p class="pm-Preview-statusNote">
  This jigsaw puzzle is not publicly listed on the site.
  </p>
  {% endif %}
  {% if recent.status == COMPLETED and recent.is_recent -%}
  <p class="pm-Preview-statusNote">
  This jigsaw puzzle has been recently completed, it can be redone after {{ recent.redo_date }}.
  </p>
  {% endif %}
  {% if recent.status == COMPLETED and not recent.is_recent -%}
  <p class="pm-Preview-statusNote">
  This jigsaw puzzle has been completed and requires using dots to redo it.  Dots are earned by putting together puzzles.
  </p>
  {% endif %}

</div>
{% endif %}
